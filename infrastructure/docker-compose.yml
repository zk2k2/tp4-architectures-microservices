# Infrastructure pour les microservices
# Pattern: Database-per-Service + Message Broker + Object Storage

version: '3.8'

services:
  # Message Broker - RabbitMQ
  rabbitmq:
    image: rabbitmq:3-management
    ports:
      - "5672:5672"    # AMQP
      - "15672:15672"  # Management UI

  # Bases de donn√©es PostgreSQL (une par service)
  application-db:
    image: postgres:15
    environment:
      POSTGRES_DB: loan_application_db
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres

  commercial-db:
    image: postgres:15
    environment:
      POSTGRES_DB: commercial_db

  risk-db:
    image: postgres:15
    environment:
      POSTGRES_DB: risk_db

  credit-db:
    image: postgres:15
    environment:
      POSTGRES_DB: credit_db

  # Stockage objet - MinIO (compatible S3)
  minio:
    image: minio/minio
    command: server /data --console-address ":9001"
    ports:
      - "9000:9000"
      - "9001:9001"
    environment:
      MINIO_ROOT_USER: minioadmin
      MINIO_ROOT_PASSWORD: minioadmin

  # API Gateway - Nginx ou Kong
  api-gateway:
    image: nginx:alpine
    ports:
      - "80:80"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
